{% extends 'base.html' %} {% block detail %}

<div class="container py-5">
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="{% url 'list-articles' %}">Articles</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        {{ articles.title }}
      </li>
    </ol>
  </nav>

  <div class="card shadow-sm">
    <div class="card-body">
      <div
        class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3"
      >
        <h1 class="h3 mb-0">{{ articles.title }}</h1>

        <div class="d-flex gap-2">
          <a href="{% url 'list-articles' %}" class="btn btn-outline-secondary">
            ‚Üê Back to list
          </a>

          {% if can_edit %}
          <a href="{% url 'edit-article' articles.pk %}" class="btn btn-primary"
            >‚úèÔ∏è Edit Article</a
          >
          <a
            href="{% url 'article-delete' articles.pk %}"
            class="btn btn-danger"
            >üóëÔ∏è Delete Article</a
          >
          {% endif %}
        </div>
      </div>

      <div class="text-muted small mb-3">
        <span class="me-3"
          >üìÖ {% if articles.publication_date %}
            {{articles.publication_date|date:"F j, Y" }}
            {% else %} Not published
        {%endif %}
        </span>

        <span class="me-3"
          >üè∑Ô∏è {% if articles.category %}
          <span class="badge text-bg-secondary">{{ articles.category }}</span>
          {% else %}
          <span class="badge text-bg-light border">No category</span>
          {% endif %}
        </span>
      </div>

      <!-- Authors -->
      <div class="mb-4">
        <h2 class="h6 text-uppercase text-muted mb-2">Authors</h2>
        {% with authors_qs=articles.authors.all %} {% if authors_qs %}
        <div class="d-flex flex-wrap gap-2">
          {% for author in authors_qs %}
          <span class="badge text-bg-dark">
            {{ author.first_name}} {{ author.last_name }}
          </span>
          {% endfor %}
        </div>
        {% else %}
        <span class="text-muted">No authors</span>
        {% endif %} {% endwith %}
      </div>
    <div class="d-flex align-items-center gap-2 ms-lg-2 my-2 my-lg-0">
      {# --- Like Form --- #}
      <div class="mb-3">
        {% if user.is_authenticated %}
        <form
          method="post"
          action="{% url 'add-like' articles.id %}"
          class="d-inline"
        >
          {% csrf_token %} {{ like_form }}
          <button
            type="submit"
            name="submit_like"
            aria-pressed="{% if user_has_liked %}true{% else %}false{% endif %}"
            title="{% if user_has_liked %}Remove like{% else %}Like this article{% endif %}"  
            class="btn btn-outline-primary {% if user_has_liked %}liked{% endif %}"
            >
            <i class="bi bi-hand-thumbs-up"></i>
            
            <span class="label">{% if user_has_liked %}UnLike{% else %}Like{% endif %}</span>
            <span class="count">{{ likes_count }}</span>
          </button>
        </form>
        {% else %}
        <a href="{% url 'login' %}" class="btn-like" title="Log in to like">
          <span class="icon" aria-hidden="true">
          </span>
          <span class="label">Like</span>
          <span class="count">{{ likes_count }}</span>
        </a>
        {% endif %}
      </div>
      {# Bookmark form #}
    <div class="mb-3">
        {% if user.is_authenticated %}
        	<form method="post" action="{% url 'add-bookmark' articles.id %}" class="d-inline">
            {% csrf_token %} {{ bookmarks_form }}
           <button
            type="submit"
            name="submit_Bookmark"
            class="btn btn-outline-success"
          > <i class="bi bi-bookmarks"></i>
           <span class="label"> {% if user_has_bookMark %} UnBookmark {% else %} Bookmark {% endif %} </span>
           <span class="count">{{ bookmarks_count }}
           </span>
           </button>
            </form>
        {% endif %}
    </div>
</div>
      <div class="mb-4">
        <h2 class="h6 text-uppercase text-muted mb-2">Content</h2>
        <div class="fs-6">
          {% if articles.content %} {{ articles.content|safe }} {% else %}
          <span class="text-muted">No content</span>
          {% endif %}
        </div>
      </div>

      <hr class="my-4" />

      <!-- Comments section -->
      <div>
        <h2 class="h6 text-uppercase text-muted mb-3">
          Comments on this Article
        </h2>

        <form method="post" class="mb-4">
          {% csrf_token %} {{ comment_form.as_p }}
          <button type="submit" class="btn btn-primary">Comment</button>
        </form>

        {% with comments=articles.comments.all %} {% if comments %}
        <ul class="list-group list-group-flush">
          {% for c in comments %}
          <li
            class="list-group-item d-flex justify-content-between align-items-start"
          >
            <div>
              <div class="mt-1">{{ c.content|linebreaksbr }}</div>
            </div>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <span class="text-muted">No comments yet.</span>
        {% endif %} {% endwith %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
